<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AnonChat ‚Äî Room</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0a0f; --surface: #111118; --card: #16161f; --border: #1e1e2d; --border-hover: #2a2a3d;
  --text: #e2e2f0; --text-muted: #6b6b8a; --text-dim: #3d3d55;
  --accent: #7c6ff7; --accent2: #a78bfa; --accent-glow: rgba(124,111,247,0.15);
  --green: #34d399; --red: #f87171; --yellow: #fbbf24;
  --msg-mine: #1a1733; --msg-theirs: #16161f; --msg-ai: #0f1a15;
  --radius: 16px; --radius-sm: 10px;
  --sidebar-w: 280px;
}
[data-theme="light"] {
  --bg: #f5f5fb; --surface: #ffffff; --card: #f0f0fa; --border: #ddddf0; --border-hover: #c0c0e0;
  --text: #1a1a2e; --text-muted: #5a5a7a; --text-dim: #b0b0c8; --accent-glow: rgba(124,111,247,0.08);
  --msg-mine: #ebe8ff; --msg-theirs: #f0f0fa; --msg-ai: #e8f5ee;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: 'Space Grotesk', sans-serif; background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

/* Header */
.room-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 12px 20px; background: var(--surface);
  border-bottom: 1px solid var(--border); flex-shrink: 0;
  position: relative; z-index: 10;
}
.header-left { display: flex; align-items: center; gap: 12px; }
.header-right { display: flex; align-items: center; gap: 8px; }
.room-id-pill {
  display: flex; align-items: center; gap: 8px;
  font-family: 'DM Mono', monospace; font-size: 14px; font-weight: 500;
  padding: 6px 14px; background: var(--card); border: 1px solid var(--border);
  border-radius: 100px; cursor: pointer; transition: all 0.2s;
}
.room-id-pill:hover { border-color: var(--accent); }
.status-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--green); box-shadow: 0 0 6px var(--green); }
.status-dot.disconnected { background: var(--red); box-shadow: 0 0 6px var(--red); animation: blink 1s infinite; }
@keyframes blink { 50% { opacity: 0.3; } }
.room-title { font-size: 15px; font-weight: 600; }
.hdr-btn {
  padding: 7px 14px; border: 1px solid var(--border); background: none;
  color: var(--text); border-radius: var(--radius-sm); cursor: pointer;
  font-family: inherit; font-size: 13px; font-weight: 500; transition: all 0.2s; display: flex; align-items: center; gap: 6px;
}
.hdr-btn:hover { border-color: var(--border-hover); }
.hdr-btn.danger:hover { border-color: var(--red); color: var(--red); }
.icon-btn { background: none; border: 1px solid var(--border); color: var(--text); width: 34px; height: 34px; border-radius: 9px; cursor: pointer; font-size: 15px; display: grid; place-items: center; transition: all 0.2s; }
.icon-btn:hover { border-color: var(--accent); background: var(--accent-glow); }
.user-count-pill { display: flex; align-items: center; gap: 6px; font-size: 13px; color: var(--text-muted); padding: 6px 12px; background: var(--card); border-radius: 100px; border: 1px solid var(--border); }

/* Layout */
.room-body { display: flex; flex: 1; overflow: hidden; }

/* Sidebar */
.sidebar {
  width: var(--sidebar-w); background: var(--surface); border-right: 1px solid var(--border);
  display: flex; flex-direction: column; flex-shrink: 0;
  transition: transform 0.3s; overflow: hidden;
}
.sidebar-header { padding: 16px 20px 12px; font-size: 12px; font-weight: 700; color: var(--text-muted); letter-spacing: 0.08em; text-transform: uppercase; border-bottom: 1px solid var(--border); }
.user-list { flex: 1; overflow-y: auto; padding: 8px; }
.user-item { display: flex; align-items: center; gap: 10px; padding: 8px 10px; border-radius: 10px; transition: background 0.2s; }
.user-item:hover { background: var(--card); }
.user-item.me { background: var(--accent-glow); }
.user-avatar { width: 32px; height: 32px; border-radius: 50%; display: grid; place-items: center; font-size: 12px; font-weight: 700; color: #fff; flex-shrink: 0; }
.ai-avatar { background: linear-gradient(135deg, #34d399, #059669); }
.user-nick { font-size: 13px; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.kick-btn { background: none; border: none; color: var(--text-dim); cursor: pointer; font-size: 12px; padding: 2px 6px; border-radius: 6px; transition: all 0.2s; }
.kick-btn:hover { color: var(--red); background: rgba(248,113,113,0.1); }

/* Admin panel */
.admin-panel {
  display: none; flex-direction: column; gap: 6px;
  padding: 12px 16px; background: rgba(124,111,247,0.05);
  border-top: 1px solid var(--border);
}
.admin-label { font-size: 11px; font-weight: 700; color: var(--accent); letter-spacing: 0.08em; text-transform: uppercase; margin-bottom: 4px; }
.admin-btn {
  padding: 8px 12px; border: 1px solid var(--border); background: none;
  color: var(--text); border-radius: 9px; cursor: pointer; font-family: inherit;
  font-size: 13px; font-weight: 500; transition: all 0.2s; text-align: left; width: 100%;
}
.admin-btn:hover { background: var(--card); border-color: var(--border-hover); }
.admin-btn.red:hover { border-color: var(--red); color: var(--red); }

/* Chat area */
.chat-area { flex: 1; display: flex; flex-direction: column; min-width: 0; }

.chat-messages {
  flex: 1; overflow-y: auto; padding: 20px 16px; display: flex; flex-direction: column; gap: 6px;
  scroll-behavior: smooth;
}
.chat-messages::-webkit-scrollbar { width: 4px; }
.chat-messages::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

/* Message types */
.msg-system {
  text-align: center; font-size: 12px; color: var(--text-muted);
  display: flex; align-items: center; justify-content: center; gap: 8px;
  padding: 4px 0; font-family: 'DM Mono', monospace;
}
.msg-system::before, .msg-system::after { content: ''; flex: 1; height: 1px; background: var(--border); }
.msg-time { font-size: 11px; color: var(--text-dim); }
.msg-broadcast {
  display: flex; align-items: flex-start; gap: 12px;
  padding: 12px 16px; background: rgba(251,191,36,0.08);
  border: 1px solid rgba(251,191,36,0.2); border-radius: 12px;
  animation: slideIn 0.3s ease;
}
.broadcast-icon { font-size: 20px; }
.msg-bubble {
  display: flex; align-items: flex-start; gap: 10px; max-width: 75%;
  animation: slideIn 0.25s ease;
}
@keyframes slideIn { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }
@keyframes fadeOut { to { opacity:0; transform:scale(0.95); } }
.msg-mine { flex-direction: row-reverse; align-self: flex-end; }
.msg-theirs { align-self: flex-start; }
.msg-ai { align-self: flex-start; max-width: 85%; }
.bubble-content { display: flex; flex-direction: column; gap: 4px; }
.bubble-header { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
.msg-mine .bubble-header { flex-direction: row-reverse; }
.bubble-nick { font-size: 12px; font-weight: 600; color: var(--text-muted); }
.bubble-time { font-size: 11px; color: var(--text-dim); font-family: 'DM Mono', monospace; }
.admin-badge { font-size: 10px; padding: 1px 6px; background: var(--accent); color: #fff; border-radius: 100px; font-weight: 700; }
.bubble-text {
  padding: 10px 14px; border-radius: 14px; font-size: 14px; line-height: 1.6;
  background: var(--msg-theirs); word-break: break-word; white-space: pre-wrap;
}
.msg-mine .bubble-text { background: var(--msg-mine); border-bottom-right-radius: 4px; }
.msg-theirs .bubble-text { border-bottom-left-radius: 4px; }
.ai-text { background: var(--msg-ai); border: 1px solid rgba(52,211,153,0.2); border-bottom-left-radius: 4px; }
.bubble-text a { color: var(--accent); }
.del-msg-btn { background: none; border: none; cursor: pointer; font-size: 12px; opacity: 0; transition: opacity 0.2s; padding: 0 4px; }
.bubble-header:hover .del-msg-btn { opacity: 0.6; }
.del-msg-btn:hover { opacity: 1 !important; }

/* AI thinking */
.msg-ai-thinking { display: flex; align-items: center; gap: 10px; padding: 8px 0; color: var(--text-muted); font-size: 13px; }
.typing-dots { display: flex; gap: 4px; }
.typing-dots span { width: 6px; height: 6px; background: var(--accent); border-radius: 50%; animation: bounce 1.2s ease-in-out infinite; }
.typing-dots span:nth-child(2) { animation-delay: 0.2s; }
.typing-dots span:nth-child(3) { animation-delay: 0.4s; }
@keyframes bounce { 0%,80%,100%{transform:translateY(0)} 40%{transform:translateY(-8px)} }

/* Typing indicator */
.typing-indicator {
  display: none; align-items: center; gap: 8px;
  padding: 6px 16px; font-size: 12px; color: var(--text-muted);
  border-top: 1px solid var(--border);
}

/* AI hint */
.ai-panel { display: none; padding: 8px 16px; background: rgba(52,211,153,0.05); border-top: 1px solid rgba(52,211,153,0.15); }
#ai-hint { font-size: 12px; color: var(--green); }

/* Input area */
.input-area {
  padding: 12px 16px 16px; border-top: 1px solid var(--border);
  background: var(--surface); display: flex; flex-direction: column; gap: 8px;
}
.input-row { display: flex; gap: 8px; align-items: flex-end; }
.input-wrapper { flex: 1; position: relative; }
textarea {
  width: 100%; padding: 12px 16px; padding-right: 48px;
  background: var(--card); border: 1px solid var(--border);
  border-radius: 14px; color: var(--text);
  font-family: inherit; font-size: 14px; line-height: 1.5;
  resize: none; outline: none; transition: all 0.2s;
  max-height: 140px; min-height: 48px;
}
textarea:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-glow); }
textarea::placeholder { color: var(--text-dim); }
.char-count {
  position: absolute; right: 12px; bottom: 10px;
  font-size: 11px; color: var(--text-dim); font-family: 'DM Mono', monospace; pointer-events: none;
}
.send-btn {
  width: 48px; height: 48px; background: var(--accent); border: none;
  border-radius: 14px; color: #fff; cursor: pointer; font-size: 18px;
  display: grid; place-items: center; transition: all 0.2s; flex-shrink: 0;
}
.send-btn:hover { background: var(--accent2); transform: scale(1.05); }
.send-btn:active { transform: scale(0.97); }

/* Toast */
@keyframes slideInRight { from{transform:translateX(100%);opacity:0} to{transform:translateX(0);opacity:1} }
@keyframes slideOutRight { from{transform:translateX(0);opacity:1} to{transform:translateX(100%);opacity:0} }

/* Mobile */
@media (max-width: 768px) {
  .sidebar { position: fixed; left: 0; top: 0; bottom: 0; z-index: 50; transform: translateX(-100%); }
  .sidebar.open { transform: translateX(0); }
  .msg-bubble { max-width: 90%; }
  .room-title { display: none; }
  .hdr-btn span { display: none; }
}
</style>
</head>
<body>

<!-- Header -->
<header class="room-header">
  <div class="header-left">
    <button class="icon-btn" id="sidebar-toggle" title="Users">üë•</button>
    <div class="room-id-pill" id="copy-room-id" title="Click to copy Room ID">
      <div id="connection-status" class="status-dot connected"></div>
      <span id="room-id-display">------</span>
    </div>
    <span class="room-title" id="room-title">Room</span>
  </div>
  <div class="header-right">
    <div class="user-count-pill">üë§ <span id="user-count">0</span></div>
    <button class="hdr-btn" id="share-btn"><span>üîó</span><span>Share</span></button>
    <button class="icon-btn" id="theme-toggle" title="Toggle theme">‚òÄÔ∏è</button>
    <button class="hdr-btn danger" id="leave-btn">üö™ Leave</button>
  </div>
</header>

<!-- Body -->
<div class="room-body">
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">Online Users</div>
    <div class="user-list" id="user-list"></div>

    <!-- Admin Panel -->
    <div class="admin-panel" id="admin-panel">
      <div class="admin-label">üëë Admin Controls</div>
      <button class="admin-btn" id="btn-lock">üîí Lock Room</button>
      <button class="admin-btn" id="btn-clear">üóëÔ∏è Clear Chat</button>
      <button class="admin-btn red" id="btn-delete">üíÄ Delete Room</button>
    </div>
  </aside>

  <!-- Chat -->
  <div class="chat-area">
    <div class="chat-messages" id="chat-messages"></div>
    
    <div class="typing-indicator" id="typing-indicator">
      <div class="typing-dots"><span></span><span></span><span></span></div>
      <span class="typing-text"></span>
    </div>

    <div class="ai-panel" id="ai-panel">
      <div id="ai-hint">ü§ñ AI enabled ‚Äî use <code>@ai your question</code> to ask the AI assistant</div>
    </div>

    <div class="input-area">
      <div class="input-row">
        <div class="input-wrapper">
          <textarea id="message-input" placeholder="Type a message‚Ä¶ (Shift+Enter for newline)" rows="1" maxlength="2000"></textarea>
          <span class="char-count" id="char-count">0/2000</span>
        </div>
        <button class="send-btn" id="send-btn" title="Send (Enter)">‚Üë</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
<script src="js/config.js"></script>
<script src="js/utils.js"></script>
<script src="js/room.js"></script>
</body>
</html>
